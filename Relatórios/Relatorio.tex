\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[portuguese]{babel}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{csquotes}
\usepackage{amsmath}
\usepackage{titlesec}
\usepackage{tabularx}
\usepackage{float}
\usepackage[table,xcdraw]{xcolor} % Adiciona este pacote no preâmbulo
\usepackage{array} % Para ajustes adicionais nas colunas
\usepackage{adjustbox}
\usepackage[backend=biber,style=apa]{biblatex}
\usepackage{tocloft}

\addbibresource{Recursos/referencias.bib}

\setlength{\parindent}{1.5cm}
\setlength{\parskip}{0.5cm}
\renewcommand{\baselinestretch}{1.5}
\setlength{\bibitemsep}{0.5cm}  % Ajuste o espaçamento entre os itens da bibliografia
\def\bibspacing{\baselineskip=10pt} % Ajusta o espaçamento entre os itens



\setcounter{secnumdepth}{2}
\renewcommand\thesection{\arabic{section}}
\renewcommand\thesubsection{\thesection.\arabic{subsection}}
\begin{document}

\begin{titlepage}
	\centering
	\includegraphics[width=0.5\textwidth]{Recursos/Logos/LOGO_IPB.png}\par
	\vspace{1cm}
	\textbf{Escola Superior de Tecnologia e Gestão}\\
	\textbf{Licenciatura em Engenharia Informática}

	\textbf{Desenvolvimento de Aplicações Web}

	\textbf{Projeto – Fase de Implementação}

	\textbf{My Anime Collection}

	\textbf{Martinho José Novo Caeiro}\\
	\textbf{Paulo António Tavares Abade}

	\includegraphics[width=0.5\textwidth]{Recursos/Logos/IPBejaESTIG.jpg}\par
	\vfill
	\textbf{Beja, janeiro de 2025}
\end{titlepage}

\newpage
\begin{titlepage}
	\centering
	\textbf{Instituto Politécnico de Beja}\\
	\textbf{Escola Superior de Tecnologia e Gestão}\\
	\textbf{Licenciatura em Engenharia Informática}

	\textbf{Desenvolvimento de Aplicações Web}

	\textbf{Projeto – Fase de Implementação}

	\textbf{My Anime Collection}

	\textbf{Martinho José Novo Caeiro}\\
	\textbf{Paulo António Tavares Abade}

	\textbf{DOCENTE}\\
	\textbf{Professor Luís Carlos Bruno}

	Trabalho realizado no âmbito da unidade curricular Desenvolvimento de Aplicações Web (\cite{daw})

	\vfill
	\textbf{Beja, janeiro de 2025}
\end{titlepage}

\renewcommand{\contentsname}{Índice}       % Título do sumário
\renewcommand{\listfigurename}{Índice de Figuras} % Título da lista de figuras
\setlength{\cftbeforesecskip}{0pt} % Ajuste conforme necessário
\setlength{\cftbeforesubsecskip}{0pt} % Ajuste conforme necessário

\newpage
\tableofcontents
\listoffigures
\newpage

\section{Introdução}
Neste relatório iremos fazer a Implementação de uma aplicação de gestão de media, que tem como objetivo ajudar a organizar o conteúdo
dos fãs de anime, ao ser possível categorizar os animes entre: Por visualizar, a visualizar, visualizados e também ser possível dar uma
classificação aos mesmos ou às listas de outros utilizadores. Irá ser feita uma API que irá conter todos os animes e os seus dados
relacionados, que será acompanhada de uma base de dados que irá guardar as informações dos utilizadores. Neste relatório será dividido em
três grandes partes, sendo estas a Análise e Desenho do Sistema cujas quais já foram desenvolvidas no relatório anterior, seguida da parte
de Implementação onde serão referidos os metodos de construção utilizados para fazer os casos de usos referidos na Analise e Desenho.

%-----------------------------------------------------------------------------------------------------------------------------%
\section{Análise do Sistema}
Para analisar o sistema, é necessário caracterizar os atores que realizarão as tarefas neste sistema, e quais serão as tarefas que serão
realizadas pelos mesmos, para isso serão utilizados os Casos de Uso, considerando a notação UML.

\section{Caracterização dos Atores}
Neste sistema o mesmo utilizador terá a posição de dois atores diferentes, sendo estes:
\textbf{Visualizador} e \textbf{Gestor de Listas}.\\
Inicialmente, todos os utilizadores assumem o papel de “Visualizador” e depois irão assumir temporariamente o papel de gestor de listas.
Para explicar como funciona, será feito o uso de Personas, que são personagens fictícios para representar o futuro utilizador deste sistema.

\subsection{Persona Nº1 - Miguel Silva}
O Miguel tem 18 anos e entrou no MyAnimeCollection para descobrir novos animes. Ao visualizar o anime “One Piece” e ter-se interessado pelo
mesmo, adicionou este anime à sua lista “A Visualizar”.

\subsection{Persona Nº2 - Catarina Silvestre}
A Catarina tem 19 anos e descobriu o MyAnimeCollection pelo Miguel, e então quis verificar o perfil dele para ver que animes ele tem nas suas
listas. Ao aceder o perfil do Miguel, viu as listas que ele tinha disponíveis no seu perfil. Após ver a lista de “A Visualizar” do Miguel,
avaliou-a com 5 estrelas.

%-----------------------------------------------------------------------------------------------------------------------------%
\section{Diagrama de Casos de Uso}
Para criar o diagrama de casos de uso, foi utilizado a plataforma draw.io, respeitando a notação de casos de uso do UML.
\begin{figure}
    \includegraphics[width=1\textwidth]{
    Recursos/Imagens/DiagramaCasoUso.png
    }\par
    \label{fig:DiagramaCasoUso}
    \caption{Diagrama de Casos de Uso}
\end{figure}

%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Caso de Uso Nº1 - Consultar Animes}
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|>{\columncolor[HTML]{EFEFEF}}l|X|}
        \hline
        \textbf{Descrição}        & Permite ao utilizador pesquisar informações sobre um anime específico, como sinopse, episódios, etc. \\ \hline
        \textbf{Atores}           & Visualizador                                                                                          \\ \hline
        \textbf{Pré-Condições}    & O utilizador deve estar conectado à internet e estar com a sessão iniciada                            \\ \hline
        \textbf{Pós-Condições}    & O anime é exibido com detalhes como sinopse, episódios, etc.                                          \\ \hline
        \textbf{Cenário Principal} & O Visualizador pesquisa um anime pelo nome, e o sistema retorna as informações detalhadas            \\ \hline
        \textbf{Situação de \mbox{Falha}} & Mostra um erro que identifica se o anime não foi encontrado ou foi um erro de conexão                \\ \hline
    \end{tabularx}
\end{table}

%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Caso de Uso Nº2 - Adicionar Animes a uma Lista}
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|>{\columncolor[HTML]{EFEFEF}}p{0.25\textwidth}|X|}
        \hline
        \textbf{Descrição}        & Permite ao utilizador adicionar um anime à sua lista pessoal de animes para organizar seu progresso de visualização \\ \hline
        \textbf{Atores}           & Gestor de Lista                                                                                                       \\ \hline
        \textbf{Pré-Condições}    & O utilizador deve estar conectado à internet e estar com a sessão iniciada                                            \\ \hline
        \textbf{Pós-Condições}    & O anime é adicionado à lista com sucesso                                                                              \\ \hline
        \textbf{Cenário \mbox{Principal}} & O Gestor de Lista navega até o anime desejado e seleciona a opção "Adicionar à lista", categorizando-o (Por Visualizar, A Visualizar, Visualizados, ou uma criada pelo utilizador) \\ \hline
        \textbf{Situação de \mbox{Falha}} & Mostra um erro que identifica uma falha na adição à lista por erro de sistema ou da conexão                          \\ \hline
    \end{tabularx}
\end{table}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Caso de Uso Nº3 - Consultar o Perfil de outro Utilizador}
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|>{\columncolor[HTML]{EFEFEF}}p{0.25\textwidth}|X|}
        \hline
        \textbf{Descrição}        & Permite visualizar o perfil e listas de outros utilizadores                                                                                           \\ \hline
        \textbf{Atores}           & Visualizador                                                                                                                                          \\ \hline
        \textbf{Pré-Condições}    & O perfil do outro utilizador deve ser acessível.                                                                                                      \\ \hline
        \textbf{Pós-Condições}    & As informações do perfil e listas são exibidas                                                                                                        \\ \hline
        \textbf{Cenário \mbox{Principal}} & O Visualizador busca pelo nome de outro utilizador e, se o perfil for acessível, o sistema exibe as informações do perfil, como listas e avaliações   \\ \hline
        \textbf{Situação de \mbox{Falha}} & Mostra um erro que identifica se a falha foi por inexistência do utilizador ou falha de conexão                                                       \\ \hline
    \end{tabularx}
\end{table}
%-----------------------------------------------------------------------------------------------------------------------------%

\subsection{Caso de Uso Nº4 - Avaliar uma Lista de Animes de outro Utilizador}
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|>{\columncolor[HTML]{EFEFEF}}p{0.25\textwidth}|X|}
        \hline
        \textbf{Descrição}        & Permite ao utilizador avaliar as listas de animes de outros utilizadores                                                                              \\ \hline
        \textbf{Atores}           & Gestor de Lista                                                                                                                                       \\ \hline
        \textbf{Pré-Condições}    & O utilizador deve estar conectado e estar com a sessão iniciada e a lista de outro utilizador deve ser acessível                                       \\ \hline
        \textbf{Pós-Condições}    & A avaliação é submetida e exibida                                                                                                                     \\ \hline
        \textbf{Cenário\mbox{Principal}} & O utilizador acessa a lista de outro utilizador, avalia e submete a avaliação, que é registada com sucesso                                            \\ \hline
        \textbf{Situação de \mbox{Falha}} & Mostra um erro que identifica uma falha ao enviar a avaliação devido a erro no sistema ou na conexão                                                  \\ \hline
    \end{tabularx}
\end{table}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Caso de Uso Nº5 (Partilhado) - Visualizar os \mbox{animes} com melhor avaliação}
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|>{\columncolor[HTML]{EFEFEF}}p{0.25\textwidth}|X|}
        \hline
        \textbf{Descrição}        & Exibe uma lista dos animes mais bem avaliados com base nas classificações de todos os utilizadores                                                    \\ \hline
        \textbf{Atores}           & Visualizador (não precisa estar com sessão iniciada)                                                                                                 \\ \hline
        \textbf{Pré-Condições}    & Deve haver dados suficientes de avaliações para gerar uma lista                                                                                     \\ \hline
        \textbf{Pós-Condições}    & Lista dos animes mais bem avaliados é exibida                                                                                                       \\ \hline
        \textbf{Cenário \mbox{Principal}} & O Visualizador acessa a página de rankings, e o sistema exibe os animes com as melhores avaliações                                                  \\ \hline
        \textbf{Situação de \mbox{Falha}} & Mostra um erro que identifica um erro de sistema                                                                                                   \\ \hline
    \end{tabularx}
\end{table}

\newpage
%-----------------------------------------------------------------------------------------------------------------------------%
\section{Desenho do Sistema}

\subsection{Modelação da Base de Dados}
Nesta parte será mostrada como será o sistema, considerando as suas tabelas e relações entre elas, e depois será mostrado o modelo físico
que indica as relações entre as tabelas, os atributos e o tipo dos mesmos.

\subsection{Diagrama E/R}
Este é o diagrama de entidade-relação utilizado pelo sistema do MyAnimeCollection:

\includegraphics[width=1\textwidth]{Recursos/Imagens/DiagramaER.png}\par
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Modelo Relacional}
\begin{itemize}
	\item UserList (userlist\_id, user\_id, animelist\_id, nome, description)
	\item AnimeList (animelist\_id, anime\_id)
	\item UserListAvaliation (userlistavaliation\_id, user\_id, id\_listaUtilizador, avaliation)
	\item AnimeAvaliation (animelistavaliation\_id, user\_id, anime\_id, avaliation)
	\item User (user\_id, nome, age, email, password, biography)
	\item Anime (anime\_id, synopsis, categories, n\_episodes, n\_seasons)
\end{itemize}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Modelo Físico}
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/ModeloFisico.png}\par
    \label{fig:ModeloFisico}
    \caption{Modelo Físico}
\end{figure}
\newpage
%-----------------------------------------------------------------------------------------------------------------------------%
\section{Modelação de Interfaces Gráficas com o Utilizador}

\subsection{Storyboard(s)}
Neste Storyboard podemos visualizar as movimentações entre páginas principais. Existem mais opções que podem ser feitas nas páginas,
porém serão apenas exploradas posteriormente.

\includegraphics[width=\dimexpr\textwidth-3cm\relax]{Recursos/Imagens/Storyboard.png}

%-----------------------------------------------------------------------------------------------------------------------------%

\subsection{Interfaces do Caso de Uso 1}
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/InterfaceCA1e2.png}\par
    \label{fig:InterfaceCA1e2}º
    \caption{Interface do Caso de Uso 1}
\end{figure}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Interfaces do Caso de Uso 2}
%-----------------------------------------------------------------------------------------------------------------------------%
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/InterfaceCA1e2.png}\par
    \label{fig:InterfaceCA1e2}
    \caption{Interface do Caso de Uso 2}
\end{figure}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Interfaces do Caso de Uso 3}
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/InterfaceCA3.png}\par
    \label{fig:InterfaceCA3}
    \caption{Interface do Caso de Uso 3}
\end{figure}
%-----------------------------------------------------------------------------------------------------------------------------%

\subsection{Interfaces do Caso de Uso 4}

\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/InterfaceCA4.png}\par
    \label{fig:InterfaceCA4}
    \caption{Interface do Caso de Uso 4}
\end{figure}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Interfaces do Caso de Uso 5}

\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/InterfaceCA5.png}\par
    \label{fig:InterfaceCA5}
    \caption{Interface do Caso de Uso 5}
\end{figure}
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Protótipo de Média Fidelidade}
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/MediaFidelidade1.png}\par
    \includegraphics[width=1\textwidth]{Recursos/Imagens/MediaFidelidade2.png}\par
    \label{fig:MediaFidelidade1}
    \caption{Protótipo de Média Fidelidade}
\end{figure}
\newpage
%-----------------------------------------------------------------------------------------------------------------------------%
% Melhorias efetuadas
\section{Melhorias efetuadas na Análise e Desenho do Sistema}
O Caso de Uso 5 foi aprofundado, agora sendo possivel visualizar animes por uma data 
especifica em vez de um periodo predefinido. Esta melhoria foi feita para que o utilizador
possa ter uma maior flexibilidade na pesquisa de animes com melhor avaliação.
Esta implementação torna o sistema mais completo e com mais funcionalidades, podendo
assim ser utilizado como uma aplicação de Sistemas de Informação, já que possui
uma funcionalidade CUBO que permite ao utilizador visualizar os dados de uma forma
mais eficiente, na questão de tempo. É limitado a animes, porém pode ser expandido
para outras especificações, como por exemplo, o género do anime, ou o estúdio que o
produziu com melhor avaliação num determinado periodo de tempo.

%-----------------------------------------------------------------------------------------------------------------------------%
\section{Implementação}

\subsection{Arquitetura do Sistema}
Para o bom funcionamento do sistema, foi necessário criar uma arquitetura que permitisse
a comunicação entre o Frontend e o Backend, e entre o Backend e a Base de Dados. A arquitetura
do sistema foi feita com recurso ao padrão MVC, que permite separar o Frontend do Backend, e
o Backend da Base de Dados. A aplicação comunica com a API e a Base de Dados e funciona como 
uma ponte entre os dois, permitindo ao utilizador interagir com o sistema. A arquitetura do sistema
é a seguinte:
\begin{figure}[H]
    \includegraphics[width=1\textwidth]{Recursos/Imagens/DeploymentDiagram.png}\par
    \label{fig:ArquiteturaSistema}
    \caption{Arquitetura do Sistema}
\end{figure}

A aplicação representa o Frontend/Computador do utilizador do sistema, que se baseia no ASPNET Core 9.0,
que é a aplicação que o utilizador interage. A aplicação comunica com a API, que possui a sua base de dados
em LocalD e a Base de Dados do Sistema, possuiu outra base de dados em LocalDB.

\newpage
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Tecnologias Usadas}
As tecnologias utilizadas para a implementação do sistema foram:
\begin{itemize}
	\item ASP.NET Core 9.0 (\cite{aspnet})
	\item Entity Framework Core (\cite{entityframework})
	\item SQL Server (\cite{sqlserver})
	\item Razor, HTML, CSS, HTML Helpers (\cite{razor})
	\item Swagger (\cite{swagger})
	\item Bootstrap (\cite{bootstrap})
\end{itemize}
Este sistema inicialmente foi desenvolvido em React, no âmbito da Unidade Curricular de 
Tecnologias Web e Desenvolvimento de Aplicações Móveis, porém, para implementar a API
e a base de dados, o grupo decidiu mudar para ASP.NET Core 9.0, devido à facilidade de
implementação da API e da base de dados, que foi feita em SQL Server, porém com uma 
metodologia de Code First. O Frontend foi desenvolvido em Razor, utilizando HTML, CSS,
Bootstrap e HTML Helpers. O Backend foi desenvolvido em C\#.
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Desenvolvimento da API}
A API foi desenvolvida em ASP.NET Core 9.0, utilizando Entity Framework Core para a
comunicação com a base de dados em LocalDB. A API foi desenvolvida com o objetivo de fornecer
os dados dos animes para o Frontend. A API foi alimentada com a API da Jinkan, que fornece
dados de animes, como sinopse, número de episódios, número de temporadas, entre outros.
Foi decido limitar os dados fornecidos pela API da Jinkan, para que a API do MyAnimeCollection
fosse mais fácil de implementar e mais leve. A API foi desenvolvida com os seguintes endpoints:
\begin{itemize}
	\item GET /api/animes - Retorna todos os animes
	\item GET /api/animes/{id} - Retorna um anime específico
	\item POST /api/animes - Adiciona um anime
	\item PUT /api/animes/{id} - Atualiza um anime
	\item DELETE /api/animes/{id} - Apaga um anime
\end{itemize}
\subsection{Especificação da Interface}
Para facilitar a compreensão do utilizador, a interface foi desenvolvida com o apoio do Swagger, 
que permite visualizar os endpoints da API e testá-los. A interface foi desenvolvida com o objetivo 
de ser simples e intuitiva, para que o utilizador possa facilmente perceber como utilizar a API.
Ao utilizar o Swagger, o programador está a fazer alterações diretas na base de dados,
da API. Como a base de dados é em LocalDB, as alterações são feitas diretamente na base de dados
local, e não na base de dados da API, que pode um dia ser implementada num servidor.
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Decisões de Implementação}
Para criar a base de dados utilizada pelo sistema, foi utilizada a metodologia Code First, que
permite criar a base de dados a partir do código. A base de dados foi criada depois com recurso 
ao Entity Framework Core, mais especificamente a parte das Migrations. \\
As rotas do sistema foram criadas de maneira a ser intuitivas e fáceis de perceber, para que o
programador que venha a trabalhar no sistema no futuro possa facilmente perceber como o sistema
funciona. Por exemplo, a rota \textit{/user/{id}} permite ao utilizador ver o perfil de um utilizador,
enquanto a rota \textit{/user/{id}/{id\_lista}} permite ao utilizador ver a lista de um utilizador.\\
Os controladores foram criados com base nos casos de uso, para que o programador possa facilmente
perceber como o sistema funciona. Por exemplo, o controlador \textit{UserController} possui todos os 
métodos relacionados com o utilizador, como \textit{Register}, \textit{Login}, \textit{Logout}, \textit{Profile},
entre outros.\\
Na questão de segurança, foi implementado um sistema de autenticação, que permite ao utilizador
registar-se e iniciar. O sistema de autenticação foi feito com recurso ao Identity, que é uma
biblioteca do ASP.NET Core que permite criar um sistema de autenticação de forma fácil e rápida.

%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Principais Casos Relevantes de Programação}
Explicação dos principais e mais complexos casos de codificação, exemplificando 
com pequenos trechos de código que permitam a um outro programador no futuro perceber esses casos.
%-----------------------------------------------------------------------------------------------------------------------------%
\section{Desenvolvimento da App Frontend/MVC}
Descrever as principais decisões e casos de implementação da App frontend/MVC.
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Decisões de Implementação}
Descrever as principais decisões globais usadas na codificação da App, justificando a escolha, 
para os casos seguintes: escolha das rotas, definições dos controladores, definições dos modelos e 
segurança do sistema. Definições dos layouts das vistas (componentes das vistas).
%-----------------------------------------------------------------------------------------------------------------------------%
\subsection{Principais Casos Relevantes de Programação}
Explicação dos principais casos de codificação para os casos de uso em causa, exemplificando com 
pequenos trechos de código e imagens das interfaces geradas pelas vistas.
\newpage
%-----------------------------------------------------------------------------------------------------------------------------%
\section{Conclusão e Trabalho Futuro}
Nesta etapa do projeto, obtivemos resultados que consideramos bastante satisfatórios e acreditamos que 
este projeto apresenta um grande potencial para o futuro. A utilização do ASP.NET, em vez do Laravel como 
inicialmente planeado, proporcionou-nos maior facilidade na implementação da API, uma vez que o ASP.NET nos 
permitiu criar uma API e um projeto MVC num único projeto, simplificando assim a comunicação entre a API e 
o Frontend. Estamos confiantes de que a aplicação tem um maior nivel de fidelidade em relação à versão feita no semestre 
anterior na Unidade Curricular de Tecnologias Web e Desenvolvimento de Aplicações Móveis, onde encontramos 
dificuldades significativas devido às limitações da RestDB, que possuía um limite que prejudicava imenso 
devido à nossa extrema necessidade para garantir ao utilizador algumas funcionalidades que tornavam a 
páginas mais intuitiva, como por exemplo, mostrar se o anime já estava adicionado a alguma lista.

%-----------------------------------------------------------------------------------------------------------------------------%

\clearpage % Garante que a bibliografia começa numa nova página
\phantomsection % Permite hiperlinks corretos no índice
\renewcommand{\refname}{Bibliografia} % Para artigos
\renewcommand{\bibname}{Bibliografia} % Para livros e relatórios
\addcontentsline{toc}{section}{Bibliografia} % Adiciona a Bibliografia ao índice
\printbibliography



\end{document}